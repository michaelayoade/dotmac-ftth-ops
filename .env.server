# =============================================================================
# DotMac Platform - Server Deployment Configuration
# =============================================================================
# This file contains the correct configuration for Docker Compose deployment
# Copy this to .env on your server: cp .env.server .env
# =============================================================================

# =============================================================================
# ENVIRONMENT
# =============================================================================
ENVIRONMENT=development
LOG_LEVEL=debug

# =============================================================================
# DATABASE CONFIGURATION (Double-underscore notation for Docker)
# =============================================================================
# IMPORTANT: Passwords MUST match docker-compose.infra.yml
DATABASE__HOST=dotmac-postgres
DATABASE__PORT=5432
DATABASE__DATABASE=dotmac
DATABASE__USERNAME=dotmac_user
DATABASE__PASSWORD=dev_local_pg_password_123

# Database URL for Alembic migrations (must use Docker container name, not localhost)
DATABASE_URL=postgresql://dotmac_user:dev_local_pg_password_123@dotmac-postgres:5432/dotmac

# =============================================================================
# REDIS CONFIGURATION (Double-underscore notation for Docker)
# =============================================================================
# IMPORTANT: Password MUST match docker-compose.infra.yml
REDIS__HOST=dotmac-redis
REDIS__PORT=6379
REDIS__DB=0
REDIS__PASSWORD=dev_local_redis_password_123

# =============================================================================
# STORAGE CONFIGURATION (Double-underscore notation for Docker)
# =============================================================================
# IMPORTANT: Credentials MUST match docker-compose.infra.yml
STORAGE__ENDPOINT=http://dotmac-minio:9000
STORAGE__ACCESS_KEY=minioadmin
STORAGE__SECRET_KEY=dev_local_minio_root_pw
STORAGE__BUCKET=dotmac
STORAGE__USE_SSL=false
# Docker container path (docker-entrypoint.sh creates this and fixes permissions)
STORAGE__LOCAL_PATH=/var/lib/dotmac/storage

# =============================================================================
# VAULT CONFIGURATION (Optional - disabled by default)
# =============================================================================
VAULT__ENABLED=false
VAULT__URL=http://dotmac-vault:8200
VAULT__TOKEN=dev-token-12345

# =============================================================================
# SECURITY SECRETS
# =============================================================================
# IMPORTANT: Change these in production!
SECRET_KEY=dev-secret-change-me-in-production-use-openssl-rand-hex-32
AUTH__JWT_SECRET_KEY=dev-jwt-secret-change-me-in-production-use-openssl-rand-hex-32

# =============================================================================
# CELERY CONFIGURATION (Double-underscore notation for Docker)
# =============================================================================
CELERY__BROKER_URL=redis://:dev_local_redis_password_123@dotmac-redis:6379/2
CELERY__RESULT_BACKEND=redis://:dev_local_redis_password_123@dotmac-redis:6379/3

# =============================================================================
# TELEMETRY / OBSERVABILITY (Double-underscore notation for Docker)
# =============================================================================
# IMPORTANT: Use container names, not localhost!
OTEL_EXPORTER_OTLP_ENDPOINT=http://dotmac-jaeger:4317
OTEL_SERVICE_NAME=dotmac-platform

# =============================================================================
# SESSION CONFIGURATION
# =============================================================================
REQUIRE_REDIS_SESSIONS=false

# =============================================================================
# PLATFORM BACKEND CONFIGURATION
# =============================================================================
PLATFORM_BACKEND_PORT=8001
PLATFORM_BACKEND_DOCKERFILE=Dockerfile
PLATFORM_BACKEND_COMMAND=uvicorn dotmac.platform.main:app --host 0.0.0.0 --port 8000

# =============================================================================
# PLATFORM FRONTEND CONFIGURATION
# =============================================================================
PLATFORM_FRONTEND_PORT=3002
PLATFORM_FRONTEND_NODE_ENV=production
PLATFORM_NEXT_PUBLIC_API_BASE_URL=http://platform-backend:8000
PLATFORM_NEXT_PUBLIC_WS_URL=ws://platform-backend:8000
PLATFORM_NEXT_PUBLIC_PRODUCT_NAME=DotMac Platform Admin
PLATFORM_NEXT_PUBLIC_PRODUCT_TAGLINE=Control plane for multi-tenant ISPs
PLATFORM_NEXT_PUBLIC_FAVICON=/favicon.ico
PLATFORM_NEXT_PUBLIC_MOCK_API=false
PLATFORM_NEXT_PUBLIC_USE_MOCK_DATA=false
PLATFORM_NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=
PLATFORM_NEXT_PUBLIC_APP_TYPE=platform-admin
PLATFORM_NEXT_PUBLIC_PORTAL_TYPE=admin

# =============================================================================
# ISP BACKEND CONFIGURATION
# =============================================================================
ISP_BACKEND_PORT=8000
ISP_BACKEND_DOCKERFILE=Dockerfile
ISP_BACKEND_COMMAND=uvicorn dotmac.platform.main:app --host 0.0.0.0 --port 8000
ISP_ENVIRONMENT=development
ISP_LOG_LEVEL=debug

# ISP Database (uses same infrastructure)
ISP_DATABASE__HOST=dotmac-postgres
ISP_DATABASE__PORT=5432
ISP_DATABASE__DATABASE=dotmac
ISP_DATABASE__USERNAME=dotmac_user
ISP_DATABASE__PASSWORD=dev_local_pg_password_123

# ISP Redis (uses same infrastructure)
ISP_REDIS__HOST=dotmac-redis
ISP_REDIS__PORT=6379
ISP_REDIS__DB=0
ISP_REDIS__PASSWORD=dev_local_redis_password_123

# ISP Storage (uses same infrastructure)
ISP_STORAGE__ENDPOINT=http://dotmac-minio:9000
ISP_STORAGE__ACCESS_KEY=minioadmin
ISP_STORAGE__SECRET_KEY=dev_local_minio_root_pw
ISP_STORAGE__BUCKET=dotmac
ISP_STORAGE__USE_SSL=false

# ISP Vault
ISP_VAULT__ENABLED=false
ISP_VAULT__URL=http://dotmac-vault:8200
ISP_VAULT__TOKEN=dev-token-12345

# ISP Security
ISP_SECRET_KEY=dev-secret-change-me-in-production-use-openssl-rand-hex-32
ISP_AUTH__JWT_SECRET_KEY=dev-jwt-secret-change-me-in-production-use-openssl-rand-hex-32

# ISP Celery
ISP_CELERY__BROKER_URL=redis://:dev_local_redis_password_123@dotmac-redis:6379/2
ISP_CELERY__RESULT_BACKEND=redis://:dev_local_redis_password_123@dotmac-redis:6379/3

# ISP Session
ISP_REQUIRE_REDIS_SESSIONS=false

# =============================================================================
# ISP FRONTEND CONFIGURATION
# =============================================================================
ISP_FRONTEND_PORT=3001
ISP_FRONTEND_NODE_ENV=production
NEXT_PUBLIC_API_BASE_URL=http://isp-backend:8000

# =============================================================================
# DOCKER COMPOSE CONFIGURATION
# =============================================================================
COMPOSE_PROJECT_NAME=dotmac-ftth-ops

# =============================================================================
# NOTES FOR SERVER DEPLOYMENT
# =============================================================================
# 1. This file is optimized for Docker Compose deployment
# 2. All service hostnames use container names (e.g., dotmac-postgres, not localhost)
# 3. Passwords match docker-compose.infra.yml infrastructure configuration
# 4. Double-underscore notation (e.g., DATABASE__HOST) is used for application configs
# 5. Change all SECRET_KEY values before production deployment
# 6. ENVIRONMENT is set to 'development' to avoid requiring Vault/OpenBao
#    For true production deployment, set ENVIRONMENT=production and VAULT__ENABLED=true
# 7. To deploy:
#    - Copy this file to .env: cp .env.server .env
#    - Run: make start-all
#    - Migrations and health checks run automatically
# =============================================================================
