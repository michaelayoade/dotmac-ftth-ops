# Local Development Environment Variables
# Copy this to .env.local and adjust as needed
#
# Usage:
#   source .env.local  # Load variables
#   pnpm dev:backend   # Start backend
#
# This file configures the backend to run directly on the host (via Poetry)
# rather than in a Docker container. Key differences from container deployment:
#
# 1. Use localhost instead of host.docker.internal (we're already on the host)
# 2. OTEL endpoint uses :4318 (HTTP) not :4317 (gRPC) for traces
# 3. Alertmanager can be disabled if not needed for local dev

# ==============================================================================
# Observability Configuration (Prevent Degraded Mode)
# ==============================================================================

# OTEL Collector endpoint for traces (HTTP)
# When running on host, use localhost:4318 (published by platform-otel-collector)
# NOTE: Base URL only - health check appends /v1/traces automatically
export OBSERVABILITY__OTEL_ENDPOINT=http://localhost:4318

# OTEL Collector endpoint for metrics/traces (gRPC)
# Used by OpenTelemetry auto-instrumentation
export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Alertmanager endpoint
# Option 1: Point to running Alertmanager
# export OBSERVABILITY__ALERTMANAGER_BASE_URL=http://localhost:9093
#
# Option 2: Disable check for local dev (recommended)
export OBSERVABILITY__ALERTMANAGER_BASE_URL=

# ==============================================================================
# Database Configuration (Optional - defaults work for localhost)
# ==============================================================================

# PostgreSQL (defaults to localhost:5432)
# export DATABASE__HOST=localhost
# export DATABASE__PORT=5432
# export DATABASE__DATABASE=dotmac
# export DATABASE__USERNAME=dotmac_user
# export DATABASE__PASSWORD=change-me

# ==============================================================================
# Redis Configuration (Optional - defaults work for localhost)
# ==============================================================================

# Redis (defaults to localhost:6379)
# export REDIS__HOST=localhost
# export REDIS__PORT=6379
# export REDIS__DB=0

# ==============================================================================
# MinIO Configuration (Optional - defaults work for localhost)
# ==============================================================================

# MinIO (defaults to localhost:9000)
# export STORAGE__ENDPOINT=http://localhost:9000
# export STORAGE__ACCESS_KEY=minioadmin
# export STORAGE__SECRET_KEY=minioadmin123
# export STORAGE__BUCKET=isp-platform
# export STORAGE__USE_SSL=false

# ==============================================================================
# Vault Configuration (Optional)
# ==============================================================================

# Vault/OpenBao (defaults to localhost:8200)
# export VAULT__ENABLED=true
# export VAULT__URL=http://localhost:8200
# export VAULT__TOKEN=dev-token-12345

# ==============================================================================
# Celery Configuration (Optional - defaults work for localhost)
# ==============================================================================

# Celery broker and result backend
# export CELERY__BROKER_URL=redis://localhost:6379/2
# export CELERY__RESULT_BACKEND=redis://localhost:6379/3

# ==============================================================================
# Development Settings
# ==============================================================================

# Environment
export ENVIRONMENT=development

# Log level
export LOG_LEVEL=debug

# Disable Redis sessions for local dev (optional)
export REQUIRE_REDIS_SESSIONS=false

# ==============================================================================
# Security (Development Only - Change in Production!)
# ==============================================================================

# Secret keys (development only)
export SECRET_KEY=dev-secret-change-me-in-production
export AUTH__JWT_SECRET_KEY=dev-jwt-secret-change-me-in-production

# ==============================================================================
# Usage Instructions
# ==============================================================================
#
# 1. Copy this file:
#    cp .env.local.example .env.local
#
# 2. Source it before starting the backend:
#    source .env.local
#    cd frontend && pnpm dev:backend
#
# 3. Or add to your shell profile (~/.bashrc, ~/.zshrc):
#    # Load DotMac dev environment
#    if [ -f ~/path/to/dotmac-ftth-ops/.env.local ]; then
#        source ~/path/to/dotmac-ftth-ops/.env.local
#    fi
#
# 4. Verify no degraded mode:
#    - Check startup logs for "âœ… Healthy: 10"
#    - Should NOT see "Running in degraded mode"
#    - Should NOT see "Required services unavailable"
#
