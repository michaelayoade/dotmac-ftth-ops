version: '3.9'

services:
  postgres:
    extends:
      file: docker-compose.base.yml
      service: postgres
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-dotmac_test}
      POSTGRES_USER: ${POSTGRES_USER:-dotmac_test}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-test_password}

  redis:
    extends:
      file: docker-compose.base.yml
      service: redis

  vault:
    extends:
      file: docker-compose.base.yml
      service: vault
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: ${VAULT_DEV_ROOT_TOKEN_ID:-test-root-token}

  otel-collector:
    extends:
      file: docker-compose.base.yml
      service: otel-collector
    volumes:
      - ./tests/fixtures/otel-collector-config.yaml:/etc/otel-collector-config.yaml:ro

volumes:
  postgres_data:

networks:
  default:
    name: ${COMPOSE_PROJECT_NAME:-dotmac}-test-network
