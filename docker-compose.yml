version: '3.9'

services:
  postgres:
    extends:
      file: docker-compose.base.yml
      service: postgres

  redis:
    extends:
      file: docker-compose.base.yml
      service: redis

  vault:
    extends:
      file: docker-compose.base.yml
      service: vault

  minio:
    extends:
      file: docker-compose.base.yml
      service: minio
    profiles:
      - storage

  celery-worker:
    extends:
      file: docker-compose.base.yml
      service: celery-worker
    profiles:
      - celery

  celery-beat:
    extends:
      file: docker-compose.base.yml
      service: celery-beat
    profiles:
      - celery

  flower:
    extends:
      file: docker-compose.base.yml
      service: flower
    profiles:
      - celery

  control-workers:
    extends:
      file: docker-compose.base.yml
      service: control-workers
    profiles:
      - workers

  otel-collector:
    extends:
      file: docker-compose.base.yml
      service: otel-collector
    profiles:
      - observability

  jaeger:
    extends:
      file: docker-compose.base.yml
      service: jaeger
    profiles:
      - observability

volumes:
  postgres_data:
  redis_data:
  vault_data:
  minio_data:
  app_logs:
  prometheus_data:
  grafana_data:

networks:
  default:
    name: ${COMPOSE_PROJECT_NAME:-dotmac}-network
